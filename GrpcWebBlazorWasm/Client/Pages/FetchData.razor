@page "/fetchdata"
@using GrpcWebBlazorWasm.Shared
@inject TouristRouteProtoSevice.TouristRouteProtoSeviceClient TouristRouteProtoSeviceClient
@inject NavigationManager Navigation

<AuthorizeView Roles="Administrators, Users">
    <Authorized>
    </Authorized>
    <NotAuthorized>
        <div class="w-75 p-3">
            <p>You'll need to <a href="" @onclick="IdentityLogin" @onclick:preventDefault><b>login</b></a> to view this component.</p>

            <p>When you login as a normal user (<i>email: <b>user@example.com</b> password: <b>Qwerty1234#</b></i>), you'll see this component but when you submit your name you'll see an error (<i>in your browser's developer console</i>: <b>403: Forbidden</b>) because the gRPC service requires you to login as an Administrator (<i>email: <b>admin@example.com</b> Password: <b>Qwerty1234#</b></i>)</p>
        </div>
    </NotAuthorized>
</AuthorizeView>

<div>
    <Table TItem="TouristRoute" DataSource="@testData">
        <Column Title="Title" @bind-Field="@context.Title" />
        <Column Title="Description" @bind-Field="@context.Description" />
        <Column Title="CreateTime" @bind-Field="@context.CreateTime" />
        <Column Title="Price" @bind-Field="@context.Price" />
    </Table>
</div>

@code {

    GrpcWebBlazorWasm.Shared.TouristRoutes testDatas;
    TouristRoute[] testData;

    protected override async Task OnInitializedAsync()
    {
        testDatas  = await TouristRouteProtoSeviceClient.GetTouristRoutesAsync(new Google.Protobuf.WellKnownTypes.Empty());
        testData = testDatas.TouristRouteList.ToArray();
    }

    private void IdentityLogin()
    {
        Navigation.NavigateTo($"authentication/login?returnUrl=" + Uri.EscapeDataString(Navigation.Uri));
    }
    
}
